{% extends "applicationPortal/base.html" %}
{% block content %}
<form action="" method="post">
    {% csrf_token %}
    <p>Select the room you want to apply for: </p>
    {% comment %} <label for="building">Choose here: </label>
    <input id="building" name="building" list="dorms">
    <button type="submit">OK</button>
    </br> {% endcomment %}
    {% comment %} {% if building %}
    <p>Showing available rooms in {{ building }}</p>
    {% endif %} {% endcomment %}
    <div class="container">
        {% comment %} <h1 class="my-4 text-center">Browse Available Rooms</h1> {% endcomment %}
    
        <!-- Building Selection -->
        <div class="mb-3">
            <label for="buildingSelect" class="form-label">Select Building:</label>
            <select id="buildingSelect" class="form-select" onchange="filterRooms()">
                <option value="0"
                    {% if selected_building_id|stringformat:"i" == "0" %}
                        selected
                    {% endif %}
                >All Buildings</option>
                
                {% for building in buildings %}
                    <option value="{{ building.id }}"
                        {% if building.id|stringformat:"i" == selected_building_id|stringformat:"i" %}
                            selected
                        {% endif %}
                    >
                        {{ building.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        
            <div class="row mb-3">
                <!-- Occupancy Filter -->
                <div class="col-md-4">
                    <label for="occupancy" class="form-label">Filter by Occupancy:</label>
                    <select name="occupancy" id="occupancy" class="form-select" onchange="submitFilters()">
                        <option value="">All</option>
                        {% for n in occupancy_options %}
                            <option value="{{ n }}" {% if selected_occupancy == n|stringformat:"s" %}selected{% endif %}>{{ n }}</option>
                        {% endfor %}
                    </select>
                </div>
        
                <!-- Floor Filter -->
                <div class="col-md-4">
                    <label for="floor" class="form-label">Filter by Floor:</label>
                    <select name="floor" id="floor" class="form-select" onchange="submitFilters()">
                        <option value="">All</option>
                        {% for floor in floors %}
                            <option value="{{ f }}" {% if selected_floor == f|stringformat:"s" %}selected{% endif %}>{{ f }}</option>
                        {% endfor %}
                    </select>
                </div>
        
                <!-- Ordering -->
                <div class="col-md-4">
                    <label for="order_by" class="form-label">Order By:</label>
                    <select name="order_by" id="order_by" class="form-select" onchange="submitFilters()">
                        <option value="">None</option>
                        <option value="size_sqft" {% if request.GET.order_by == "size_sqft" %}selected{% endif %}>Size ↑</option>
                        <option value="-size_sqft" {% if request.GET.order_by == "-size_sqft" %}selected{% endif %}>Size ↓</option>
                        <option value="total_occupancy" {% if request.GET.order_by == "total_occupancy" %}selected{% endif %}>Occupancy ↑</option>
                        <option value="-total_occupancy" {% if request.GET.order_by == "-total_occupancy" %}selected{% endif %}>Occupancy ↓</option>
                    </select>
                </div>
            </div>
        
    
        <!-- Room Cards -->
        <div class="row" id="roomList">
            {% for room in rooms %}
            <div class="col-md-4 mb-4 room-card" data-building-id="{{ room.building.id }}">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Room {{ room.room_number }} (Floor {{ room.floor_number }})</h5>
                        <p class="card-text">
                            <strong>Size:</strong> {{ room.size_sqft }} sqft<br>
                            <strong>Total Occupancy:</strong> {{ room.total_occupancy }}<br>
                            <strong>Availability:</strong> 
                            {% if room.is_available %}
                                <span class="text-success">Available</span>
                            {% else %}
                                <span class="text-danger">Occupied</span>
                            {% endif %}
                            <br>
                            <strong>Furnishings:</strong> 
                            {% for furnishing in room.furnishings.all %}
                                {{ furnishing.type }}{% if not forloop.last %}, {% endif %}
                            {% empty %}
                                None
                            {% endfor %}
                        </p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    </br>
{% comment %} 
    <datalist id="dorms">
        <option value="Stephenson">
        <option value="Rogers">
        <option value="Olympia">
        <option value="Northside">
        <option value="Duncan Dunn">
    </datalist> {% endcomment %}

    {% comment %} {% if building == 'Stephenson' %}
    <div class="rooms-list">
        <div class="box">
            <h2>ROOM 101</h2>
            <p>Occupancy: 2</p>
            <p>Furnishings: None</p>
        </div>
        <div class="box">
            <h2>ROOM 102</h2>
            <p>Occupancy: 2</p>
            <p>Furnishings: Refrigerator</p>
        </div>
    </div>

    {% endif %} {% endcomment %}

</form>

<br>
<br>
<div class="buttons-container">
<button onclick="location.href='/application/page1/'">
    PREVIOUS
</button>
<button onclick="location.href='/application/page3/'">
    NEXT
</button>
</div>

 {% comment %}
    select room and floor
    select single or double (occupancy)
    room furnishings
    check availability
    {% endcomment %}
    
    <script>
        function filterRooms() {
            const selectedBuilding = document.getElementById('buildingSelect').value;
            const urlParams = new URLSearchParams(window.location.search);
    
            if (selectedBuilding && selectedBuilding !== "0") {
                urlParams.set('building_id', selectedBuilding);
            } else {
                urlParams.delete('building_id');  // Remove if "All Buildings" is selected
            }
    
            // Update URL and reload the page
            window.location.href = window.location.pathname + "?" + urlParams.toString();
        }
    </script>

    <script>
        function submitFilters() {
            document.getElementById("filter-form").submit();
        }
    </script>

{% endblock content %}
    